<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>

<button id="btn">微信登录</button>
<script type="text/javascript">
			const handleLogin = () => {
				// let local = window.location.href.split('#')[0];
				let url =
					'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxd396e21301f850a4&redirect_uri=' +
					encodeURIComponent('http://other.yingxiong.com/cd/hxs/web/wxRedirect.html') +
					'&response_type=code&scope=snsapi_userinfo&state=1#wechat_redirect';
				console.log('window.location.href', window.location.href);
				let code = getUrlQuery().code;
				if (!code) {
					window.location.href = url;
					 console.log("code", code);
				} else {
					code = getUrlQuery().code
					console.log('code', code);
				}
			};
			const getUrlQuery = (url) => {
			  url = url == null ? window.location.href : url;
			  const search = url.substring(url.lastIndexOf('?') + 1);
			  const obj= {};
			  const reg = /([^?&=]+)=([^?&=]*)/g;
			  search.replace(reg, (rs, $1, $2) => {
			    const name = decodeURIComponent($1);
			    let val = decodeURIComponent($2);
			    val = String(val);
			    obj[name] = val;
			    return rs;
			  });
			  return obj;
			};
			btn.addEventListener("click", handleLogin)
		</script>
</body>
</html>